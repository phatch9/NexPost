import{r as l,c as U,j as e,d as P,u as S,f as w,e as b,b as A,g as M,L as _}from"./index-C5ZQxRwH.js";import{I as E}from"./InfinitePosts-CQg8nO6j.js";import{m as N,A as k}from"./proxy-DXfvcpxa.js";import{Chat as L}from"./Inbox-BYKjItPZ.js";import"./PostCurrent-CpKU4QIs.js";const C=({children:u,setShowModal:n})=>{const t=l.useRef(null);return U("click",a=>{a.target===t.current&&n&&n(!1),a instanceof KeyboardEvent&&a.key==="Escape"&&n&&n(!1)},document),e.jsx(N.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",ref:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx(N.div,{className:"bg-white rounded-lg shadow-lg p-6 max-w-lg w-full",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:u})})};function T({setModal:u}){const n=P(),{user:t}=S(),[a,r]=l.useState(t.bio||""),[d,m]=l.useState(null),[s,h]=l.useState("image"),[f,g]=l.useState(""),[o,p]=l.useState(null),[y,j]=l.useState(!1),D=i=>{const c=i.target.files?.[0];c&&(c.size>10485760?(p("File too large. Only upload files less than 10MB."),i.target.value="",m(null)):(p(null),m(c)))};async function F(i){i.preventDefault(),j(!0),p(null);const c=new FormData;c.append("bio",a),c.append("content_type",s),c.append("content_url",f),d&&c.append("avatar",d,d.name);try{const x=await b.patch("/api/user",c,{headers:{"Content-Type":"multipart/form-data"}});u(!1);const v=x.data;n.setQueryData(["user",t.username],()=>v),n.setQueryData(["user"],()=>v)}catch(x){console.error("Profile update failed:",x),p(`Update failed: ${x.message||"Please check your input fields."}`)}finally{j(!1)}}return l.useEffect(()=>(w.setFocused(!1),()=>w.setFocused(!0)),[]),e.jsxs("div",{className:"flex flex-col p-5 space-y-5 w-5/6 rounded-md min-h-3/6 md:w-3/4 md:p-10 bg-theme-cultured",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center p-4 space-y-3 bg-white rounded-xl md:flex-row md:space-y-0",children:[e.jsx("p",{className:"text-lg font-semibold",children:"Updating Profile for"}),e.jsx("img",{src:t.avatar||avatar,className:"object-cover w-12 h-12 rounded-full md:w-16 md:h-16 shadow-md",alt:`${t.username}'s avatar`}),e.jsx("p",{className:"text-xl font-bold text-theme-orange",children:t.username})]}),o&&e.jsx("div",{className:"p-3 text-sm font-semibold text-white bg-red-500 rounded-lg shadow-inner",children:o}),e.jsxs("form",{className:"flex flex-col p-5 space-y-6 bg-white rounded-md shadow-lg",onSubmit:F,children:[e.jsxs("label",{htmlFor:"bio",className:"flex flex-col space-y-2",children:[e.jsx("span",{className:"text-base font-medium text-gray-700",children:"Bio"}),e.jsx("textarea",{value:a,onChange:i=>r(i.target.value),name:"bio",id:"bio",placeholder:"Tell us a little about yourself...",className:"w-full h-24 p-3 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-theme-orange",maxLength:500})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-5 space-y-3 md:space-y-0",children:[e.jsxs("label",{htmlFor:"mediaType",className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-medium text-gray-700 mb-1",children:"Avatar Source"}),e.jsxs("select",{className:"py-2 px-4 bg-gray-50 border border-gray-300 rounded-md focus:ring-theme-orange focus:border-theme-orange",name:"mediaType",id:"mediaType",value:s,onChange:i=>h(i.target.value),children:[e.jsx("option",{value:"image",children:"Upload Image"}),e.jsx("option",{value:"url",children:"External URL"})]})]}),s==="image"?e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-1",children:"Image File"}),e.jsx("input",{onChange:D,type:"file",name:"file",accept:"image/*",id:"image",className:"w-full focus:outline-none file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-theme-cultured file:text-theme-orange hover:file:bg-gray-100"}),d&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["File ready: ",d.name]})]}):e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-1",children:"Image URL"}),e.jsx("input",{type:"url",name:"media_url",id:"media_url",placeholder:"https://example.com/avatar.jpg",className:"p-2 w-full rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-theme-orange",value:f,onChange:i=>g(i.target.value)})]})]}),e.jsx("p",{className:"text-xs font-medium text-blue-600 p-2 border border-blue-200 bg-blue-50 rounded-md",children:"Note: If you submit a new image or URL, it will overwrite your current profile picture. Leave the field empty to keep your existing avatar."}),e.jsx("button",{type:"submit",disabled:y,className:"py-3 font-semibold text-lg text-white rounded-lg bg-theme-orange hover:bg-orange-600 active:scale-[0.98] transition-all duration-150 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md",children:y?"Updating...":"Save Profile"})]})]})}function $(){const{logout:u,user:n}=S(),{username:t}=A(),[a,r]=l.useState(!1),[d,m]=l.useState(!1),{data:s,isFetching:h}=M({queryKey:["user",t],queryFn:async()=>await b.get(`/api/user/${t}`).then(o=>o.data)});l.useEffect(()=>{if(typeof a=="string")switch(a){case"message":r(e.jsx(L,{sender:s,setCurChat:r,newChat:!0}));break;case"edit":r(e.jsx(T,{setModal:r}));break;case"delete":m(!0),r(!1);break;default:r(!1)}},[a,s]),l.useEffect(()=>(document.title="u/"+t,()=>{document.title="NexPost"}),[t]);const f=l.useCallback(()=>{m(!1),b.delete("/api/user").then(()=>u()).catch(o=>console.error(o))},[u]),g=a!==!1&&typeof a!="string";return e.jsx("div",{className:"flex flex-col flex-1 items-center w-full bg-gray-50 min-h-screen font-inter",children:e.jsxs("div",{className:"w-full max-w-3xl p-4",children:[h?e.jsx("div",{className:"mt-10",children:e.jsx(_,{forPosts:!0})}):e.jsx("div",{className:"flex flex-col items-center w-full bg-gray-50",children:e.jsxs("div",{className:"flex flex-col p-4 w-full bg-white rounded-xl shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center p-4 w-full rounded-xl bg-gray-100 border",children:[e.jsx("img",{src:s?.avatar||"/default_avatar.png",className:"object-cover w-28 h-28 md:w-40 md:h-40 rounded-full shadow-md cursor-pointer hover:shadow-xl",alt:"User Avatar",onClick:()=>r(e.jsx("img",{src:s?.avatar||"/default_avatar.png",className:"object-cover w-full max-h-[80vh] rounded-md",alt:"Full Avatar"}))}),e.jsxs("div",{className:"flex flex-col flex-1 items-center md:items-start mt-4 md:mt-0 md:p-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["u/",s?.username]}),e.jsx("p",{className:"my-2 text-sm md:text-base text-gray-600 italic",children:s?.bio||"No bio provided."}),e.jsxs("div",{className:"flex justify-between w-full px-4 md:px-0 mt-2",children:[e.jsxs("p",{className:"font-medium",children:["Karma: ",s?.karma.user_karma]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Cake Day: ",new Date(s?.registrationDate??Date.now()).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex flex-col mt-4 p-2 text-sm bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between p-1 border-b",children:[e.jsx("p",{className:"font-semibold",children:"Total Posts:"}),e.jsx("p",{children:s?.karma.posts_count})]}),e.jsxs("div",{className:"flex justify-between p-1 border-b",children:[e.jsx("p",{className:"font-semibold",children:"Posts Karma:"}),e.jsx("p",{children:s?.karma.posts_karma})]}),e.jsxs("div",{className:"flex justify-between p-1 border-b",children:[e.jsx("p",{className:"font-semibold",children:"Total Comments:"}),e.jsx("p",{children:s?.karma.comments_count})]}),e.jsxs("div",{className:"flex justify-between p-1",children:[e.jsx("p",{className:"font-semibold",children:"Comments Karma:"}),e.jsx("p",{children:s?.karma.comments_karma})]})]}),e.jsxs("select",{name:"options",id:"options",className:"p-3 mt-4 rounded-lg border-2 border-gray-300 cursor-pointer",value:typeof a=="string"?a:"",onChange:o=>r(o.target.value===""?!1:o.target.value),children:[e.jsx("option",{value:"",children:"Choose an action"}),n.username===s?.username&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"edit",children:"Update Profile"}),e.jsx("option",{value:"delete",children:"Delete Account"})]}),n.username!==s?.username&&e.jsxs("option",{value:"message",children:["Message ",s?.username]})]})]})}),e.jsx(E,{apiQueryKey:s?.username,linkUrl:`posts/user/${s?.username}`,enabled:!!s?.username}),e.jsx(k,{children:g&&e.jsx(C,{showModal:a,setShowModal:r,children:a})}),e.jsx(k,{children:d&&e.jsx(C,{showModal:d,setShowModal:m,children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Confirm Account Deletion"}),e.jsx("p",{className:"text-gray-700",children:"Are you sure? This cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-gray-200 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:f,className:"px-4 py-2 bg-red-600 text-white rounded-lg",children:"Delete"})]})]})})})]})})}export{$ as Profile,$ as default};
