import{Q as C,k as y,l as E,m as R,n as k,o as B,r as F,j as t,L as b,e as M}from"./index-C5ZQxRwH.js";import{P as O}from"./PostCurrent-CpKU4QIs.js";import{m as Q,A as S}from"./proxy-DXfvcpxa.js";var $=class extends C{constructor(s,i){super(s,i)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:y()})}getOptimisticResult(s){return s.behavior=y(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,i){const{state:u}=s,x=super.createResult(s,i),{isFetching:r,isRefetching:g,isError:n,isRefetchError:h}=x,o=u.fetchMeta?.fetchMore?.direction,c=n&&o==="forward",d=r&&o==="forward",m=n&&o==="backward",p=r&&o==="backward";return{...x,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:R(i,u.data),hasPreviousPage:E(i,u.data),isFetchNextPageError:c,isFetchingNextPage:d,isFetchPreviousPageError:m,isFetchingPreviousPage:p,isRefetchError:h&&!c&&!m,isRefetching:g&&!d&&!p}}};function A(s,i){return k(s,$)}const D=({linkUrl:s,apiQueryKey:i,forSaved:u=!1,enabled:x=!0})=>{const[r,g]=B(),n=r.get("sortBy")||"top",h=r.get("duration")||"alltime",{data:o,isFetching:c,hasNextPage:d,fetchNextPage:m}=A({queryKey:["posts",i,n,h],queryFn:async({pageParam:e=0})=>{const a=e*20,l=`/api/${s}?limit=20&offset=${a}&sortby=${n}&duration=${h}`;return(await M.get(l)).data},enabled:x,getNextPageParam:(e,a)=>{if(!(e.length<20))return a.length},staleTime:300*1e3,initialPageParam:0});F.useEffect(()=>{const e=a=>{const l=a.target.scrollingElement;if(!l)return;const{scrollTop:f,scrollHeight:N,clientHeight:w}=l;N-f<=w*2&&d&&!c&&m()};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[m,c,d]);function p(e){r.set("duration",e),g(r,{replace:!0})}function P(e){r.set("sortBy",e),g(r,{replace:!0})}function v(e,a){a==="sortBy"?P(e.target.value):p(e.target.value)}const j=o?.pages[0]?.length===0;return t.jsxs("div",{id:"main-content",className:"flex w-full flex-col flex-1 p-2 space-y-3 rounded-lg m-0.5 bg-theme-cultured md:bg-white md:m-3",children:[!u&&t.jsxs("header",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center space-x-2 md:hidden",children:[t.jsx("span",{children:"Sort by"}),t.jsxs("select",{name:"sort",id:"sort",className:"p-2 px-4 bg-white rounded-md md:bg-theme-cultured",onChange:e=>v(e,"sortBy"),value:n,children:[t.jsx("option",{value:"top",children:"Top"}),t.jsx("option",{value:"hot",children:"Hot"}),t.jsx("option",{value:"new",children:"New"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2 md:hidden",children:[t.jsx("span",{children:"Of"}),t.jsxs("select",{name:"duration",id:"duration",className:"p-2 px-4 bg-white rounded-md md:bg-theme-cultured",onChange:e=>v(e,"duration"),value:h,children:[t.jsx("option",{value:"day",children:"Day"}),t.jsx("option",{value:"week",children:"Week"}),t.jsx("option",{value:"month",children:"Month"}),t.jsx("option",{value:"year",children:"Year"}),t.jsx("option",{value:"alltime",children:"All Time"})]})]}),t.jsx("ul",{className:"hidden space-x-2 list-none md:flex",children:["day","week","month","alltime"].map(e=>t.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${h===e&&"bg-theme-gray-blue"}`,onClick:()=>p(e),children:e.charAt(0).toUpperCase()+e.slice(1).replace("time"," Time")},e))}),t.jsx("ul",{className:"hidden mr-5 space-x-5 list-none md:flex",children:["hot","new","top"].map(e=>t.jsx("li",{className:`p-2 hover:bg-theme-gray-blue rounded-md px-4 text-lg cursor-pointer ${n===e&&"bg-theme-gray-blue"}`,onClick:()=>P(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),c&&t.jsx(b,{forPosts:!0}),j?t.jsx(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},children:t.jsxs("p",{className:"p-5 bg-white rounded-xl border-2 md:text-base hover:shadow-sm border-theme-gray-blue",children:["No posts with this filter were found, ",t.jsx("br",{className:"md:hidden"}),"Be the first to add one!"]})}):t.jsx("div",{className:"flex flex-col space-y-2 md:space-y-3",children:o?.pages.map((e,a)=>t.jsx("ul",{className:"flex flex-col space-y-2 md:space-y-3",children:t.jsx(S,{children:e?.map((l,f)=>t.jsx(O,{post:l,postIndex:f},l.post_info.id))})},a))}),c&&d&&t.jsx(b,{forPosts:!0})]})};export{D as I};
